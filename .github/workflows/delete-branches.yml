name: Delete Branches

run-name: Delete branch ${{ inputs.branch_name }}

on:
  workflow_dispatch:
    inputs:
      branch_name:
        description: 'Name of the branch to delete'
        required: true
        type: string

jobs:
  delete-branches:
    runs-on: ubuntu-latest
    steps:
    - name: Generate GitHub App token
      id: app-token
      uses: actions/create-github-app-token@v1
      with:
        app-id: ${{ secrets.APP_ID }}
        private-key: ${{ secrets.PRIVATE_KEY }}
    - name: Delete branches in all repos
      run: |
        repos=("ismenablement/poc2repoA" "ismenablement/poc2repoB" "ismenablement/poc2repoC")
        branch="${{ inputs.branch_name }}"
        for repo in "${repos[@]}"; do
          echo "Checking branch $branch in $repo"
          if gh api repos/$repo/branches/$branch --silent 2>/dev/null; then
            echo "Branch exists, deleting..."
            gh api repos/$repo/git/refs/heads/$branch -X DELETE
            echo "Deleted branch $branch in $repo"
          else
            echo "Branch $branch does not exist in $repo"
          fi
          echo "---"
        done
      env:
        GH_TOKEN: ${{ steps.app-token.outputs.token }}