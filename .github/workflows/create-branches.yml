name: Create Branches

run-name: Create branch ${{ inputs.branch_name }}

on:
  workflow_dispatch:
    inputs:
      branch_name:
        description: 'Name of the branch to create'
        required: true
        type: string

jobs:
  create-branches:
    runs-on: ubuntu-latest
    steps:
    - name: Generate GitHub App token
      id: app-token
      uses: actions/create-github-app-token@v1
      with:
        app-id: ${{ secrets.APP_ID }}
        private-key: ${{ secrets.PRIVATE_KEY }}
    - name: Create branches in all repos
      run: |
        repos=("ismenablement/poc2repoA" "ismenablement/poc2repoB" "ismenablement/poc2repoC")
        branch="${{ inputs.branch_name }}"
        for repo in "${repos[@]}"; do
          echo "Creating branch $branch in $repo"
          main_sha=$(gh api repos/$repo/git/refs/heads/main -q .object.sha)
          echo "Main SHA for $repo: $main_sha"
          gh api repos/$repo/git/refs -f ref=refs/heads/$branch -f sha=$main_sha
          echo "---"
        done
      env:
        GH_TOKEN: ${{ steps.app-token.outputs.token }}